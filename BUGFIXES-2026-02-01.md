# üîß Bug Fixes - 1er F√©vrier 2026

## ‚úÖ Probl√®me #1: Timeout 30000ms lors de la cr√©ation de playlist

### Sympt√¥me
Lors de la cr√©ation d'une playlist (manuelle ou IA), le message d'erreur s'affichait:
```
‚ùå timeout of 30000ms exceeded
```

### Cause
Le timeout par d√©faut dans le client API √©tait fix√© √† 30 secondes, ce qui n'√©tait pas suffisant pour:
- Les requ√™tes de g√©n√©ration de playlist par IA (calcul intensif)
- Les requ√™tes avec beaucoup de donn√©es

### Solution
‚úÖ Augmenter le timeout de 30s √† 60s dans `frontend/src/api/client.ts`:
```typescript
timeout: 60000, // 60 secondes timeout pour les requ√™tes longues
```

### Fichiers Modifi√©s
- `frontend/src/api/client.ts` (ligne 8)

### Impact
- Les requ√™tes de cr√©ation prennent maintenant jusqu'√† 60 secondes avant timeout
- Permet les op√©rations intensives (g√©n√©ration IA, recherche complexe)

---

## ‚úÖ Probl√®me #2: Track actuellement jou√© affich√©e dans TOUTES les playlists

### Sympt√¥me
Quand une lecture √©tait en cours sur une playlist, le track en cours s'affichait dans **TOUTES les playlists** au lieu de seulement celle active.

Exemple:
```
Playlist A: [En cours de lecture: Track X] ‚Üê Correct
Playlist B: [En cours de lecture: Track X] ‚Üê INCORRECT
Playlist C: [En cours de lecture: Track X] ‚Üê INCORRECT
```

### Cause
Le composant affichait `roon.nowPlaying` sans v√©rifier si c'√©tait la playlist active. La condition d'affichage √©tait:
```typescript
{roon.nowPlaying && (
  // Affiche pour TOUTES les playlists avec nowPlaying
)}
```

### Solution
‚úÖ Ajouter une v√©rification pour afficher SEULEMENT si c'est la playlist active:
```typescript
{roon.nowPlaying && playingPlaylistId === playlist.id && (
  // Affiche SEULEMENT pour la playlist active
)}
```

### Fichiers Modifi√©s
- `frontend/src/pages/Playlists.tsx`
  - Ligne 453: Ajouter condition `playingPlaylistId === playlist.id`
  - Ligne 744: Set `playingPlaylistId` AVANT mutation

### Changements D√©taill√©s

#### Avant:
```typescript
// ‚ùå Affiche pour toutes les playlists
{roon.nowPlaying && (
  <Box>
    {roon.nowPlaying.title}
  </Box>
)}
```

#### Apr√®s:
```typescript
// ‚úÖ Affiche SEULEMENT pour la playlist active
{roon.nowPlaying && playingPlaylistId === playlist.id && (
  <Box>
    {roon.nowPlaying.title}
  </Box>
)}
```

#### Mutation Callback:
```typescript
// ‚úÖ Set playingPlaylistId AVANT mutation
onClick={() => {
  if (selectedZone && pendingPlaylistId) {
    setPlayingPlaylistId(pendingPlaylistId)  // NEW!
    playPlaylistMutation.mutate({...})
  }
}}
```

### Impact
- Affichage du track actuellement jou√© SEULEMENT sur la playlist active
- Meilleure clart√© UX
- Pas de confusion entre playlists

---

## üìä R√©sum√© des Corrections

| Probl√®me | Cause | Solution | Impact |
|----------|-------|----------|--------|
| Timeout 30s | Timeout trop court | Augmenter √† 60s | Requ√™tes longues OK ‚úÖ |
| Track partout | Pas de v√©rification | Ajouter condition playingPlaylistId | Affichage correct ‚úÖ |

---

## üß™ Tests Recommand√©s

### Test #1: Cr√©ation de Playlist Lente
```bash
# Tester la cr√©ation avec un algorithme complexe
# Devrait prendre ~30-45s sans timeout
```

### Test #2: Affichage du Track
```bash
1. Cr√©er 3 playlists
2. Lancer lecture sur playlist #2
3. V√©rifier que SEULEMENT playlist #2 affiche le track en cours
4. Playlists #1 et #3 ne doivent PAS afficher le track
```

### Test #3: Changement de Playlist
```bash
1. Lancer playlist #2
2. Voir le track affich√© sur #2
3. Lancer playlist #1
4. V√©rifier que le track s'affiche sur #1
5. V√©rifier que le track disapara√Æt de #2
```

---

## üìù Notes Techniques

### Pourquoi timeout 60s?
- G√©n√©ration IA: 20-40s
- Requ√™tes complexes: 10-20s
- Buffer de s√©curit√©: 5-10s
- Total: ~60s est raisonnable

### √âtat `playingPlaylistId`
- D√©fini lors du click "Lancer"
- Maintenu pendant toute la lecture
- R√©initialis√© si erreur ou arr√™t manuel
- Utilis√© pour filtrer l'affichage du track

---

## ‚úÖ Checklist Post-Fix

- [x] Timeout augment√©
- [x] Condition d'affichage corrig√©e
- [x] Set playingPlaylistId au bon moment
- [x] Tests manuels OK
- [x] Git commits clean
- [x] Documentation compl√®te

---

**Status**: üü¢ Fixes Completed  
**Date**: 1er F√©vrier 2026  
**Version**: 1.0.1
